var Grailbird=function (b,a,c){Grailbird.data=Grailbird.data||{};Grailbird.data[b+"_"+a]=c};
(function (b) {
	var f={},e={},a={}; var c={
		empty_hour: Hogan.compile('<li class="without-tweets" title="" rel="tooltip" data-placement="bottom" data-date="" data-count="0"><span class="value">{{hour}}</span></li>'),
		hour_bar: Hogan.compile('<li><a href="#" class="with-tweets" title="{{str_title}}: {{str_count}}" rel="tooltip" data-placement="bottom" data-idx="{{data_idx}}" data-date="{{str_title}}" data-count="{{this_count}}"><span class="bar" style="height: {{this_height}}%;"></span><span class="value">{{hour}}</span></a></li>'),
		header_str: Hogan.compile('{{title_str}} <span class="count">{{count}} {{content_type}}</span>'),
		nav_tab: Hogan.compile('<li class="{{sectionClass}}"><a href="#">{{sectionName}}</a></li>'),
	};
	b.init = function (){
		Grailbird.localizeStrings(); var g = $(document), h = $(".tweets-header");
		twt.settings.showLocalTimes = true; twt.settings.product = "archive"; twt.settings.lang = "lolc";
		Grailbird.data = Grailbird.data || {}; Grailbird.current_index = 0; e = Grailbird.tweets(); e.init();
		$(".brand").click(function (i) {
			i.preventDefault(); i.stopImmediatePropagation(); $(".row .contents, .sidebar").removeClass("container-messages");
			$(".tweets-header .nav-clear").hide(); e.init()
		});
		$(".tweets-header .nav-arrow").tooltip().click(function (){ e.displayTweets(Number($(this).attr("data-idx"))); $(this).tooltip("show") });
		$(document).keyup(function (i) {
			if (i.keyCode === 37) { i.preventDefault(); $(".nav-arrow-left:visible").click(); $(".nav-arrow-right").tooltip("hide") }
			if (i.keyCode === 39) { i.preventDefault(); $(".nav-arrow-right:visible").click(); $(".nav-arrow-left").tooltip("hide") }
		});
		$(".container").touchwipe({
			wipeRight: function(){ $(".nav-arrow-left:visible").click(); $(".nav-arrow-right").tooltip("hide") },
			wipeLeft: function(){ $(".nav-arrow-right:visible").click(); $(".nav-arrow-left").tooltip("hide") }
		});
		$(window).scroll(function () { var i = g.scrollTop(); if (i > 0) { h.addClass("raised") } else { h.removeClass("raised") } })
	};

	b.extend=function (m){var h=Array.prototype.slice.call(arguments,1),j=0,g=h.length,n,k;for(j;j<g;j++){k=h[j];for(n in k){if(k[n]!==undefined){m[n]=k[n]}}} return m};

	(function (g) {
		g.base = {
			init: function () { this.buildNavigation(); this.displayTweets(0) },
			pluralize: function (h){return (Number(h) === 1)?this.str_singular:this.str_plural},
			buildNavigation: function () {
				var k = ["Err", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
					h = $('<div class="histogram"><h3></h3><ol class="hours unstyled"></ol></div>'), s = this, l, n = [], p;

				$(".content-nav").empty();

				var m = _.max(this.status_index,function (i){return i.tweet_count}),
					j = function (){
						if (l){
							n=n.reverse();
							if(n.length<24){for(var i=0;i<24;i++){if(!n[i]||n[i].match(/class="value">(\d+)<\/span>/)[1]!=i){n.splice(i,0,c.empty_hour.render({hour:i}))}}}
							l.find(".hours").append(n.join(""))
						}
					};

				for (var o = 0; o < this.status_index.length; o++) {
					var r = {
						year: this.status_index[o]["year"], month: this.status_index[o]["month"], day: this.status_index[o]["day"], hour: this.status_index[o]["hour"],
						this_count: Grailbird.insertCommas(this.status_index[o]["tweet_count"]), this_height: (this.status_index[o]["tweet_count"]/m.tweet_count)*100,
						str_count: Grailbird.insertCommas(this.status_index[o]["tweet_count"])+" "+this.pluralize(this.status_index[o]["tweet_count"]), data_idx: o
					};
					r.str_title = (r.hour<10?("0"+r.hour):r.hour)+"00h, "+r.day+" "+k[r.month]+" "+r.year; this.status_index[o]["title_str"] = r.str_title;
					if ( r.day !== p ){ j(); l=h.clone(); n = []; l.find("h3").text(r.day+" "+k[r.month]+" "+r.year); $(".content-nav").append(l); p = r.day }
					n.push(c.hour_bar.render(r));
				}
				j(); $(".hours .with-tweets").tooltip().click(function () { s.displayTweets(Number($(this).attr("data-idx"))) })
			},
			displayTweets: function (i) {
				Grailbird.current_index = i; var k = { border: false, showMedia: true, popupWebIntents: true };
				if (this.status_index.length == 0) return;
				var o = this, n = 0, p = 0, m = this.status_index[i], h = m.var_name,
					l = c.header_str.render({title_str:m.title_str,count:Grailbird.insertCommas(m.tweet_count),content_type:this.pluralize(m.tweet_count)}),
					j = function () {
						$(".tweets-header-title").fadeOut(100);
						$(".container .contents .tweets").fadeOut(100, function () {
							$(".tweets-header-title").empty().html(l).attr("title", "");
							$(this).empty(); $(window).scrollTop(0);
							twt.timeline(Grailbird.data[h], k).renderTo(".tweets");
							$(".tweets-header-title").fadeIn(100);$(this).fadeIn(100)
						})
					};
				if (this.status_index[i].year === undefined) {
					$(".user-list .user").removeClass("active"); $($(".user-list .user")[i]).addClass("active"); k.showActions = false
				} else {
					$(".hours .with-tweets, .histogram").removeClass("active");
					$('.hours .with-tweets[data-idx="'+i+'"]').addClass("active").parents(".histogram").addClass("active")
				}
				n = Number(i) + 1; p = Number(i) - 1;
				if (i === 0) { p = null; $(".tweets-header .nav-arrow-right").hide() }
				if (this.status_index.length - 1 == i) { n = null; $(".tweets-header .nav-arrow-left").hide() }
				if (i < this.status_index.length - 1) { $(".tweets-header .nav-arrow-left").attr({ "data-idx": n, "data-original-title": this.status_index[n]["title_str"] }).show() }
				if (i > 0) { $(".tweets-header .nav-arrow-right").attr({ "data-idx": p, "data-original-title": this.status_index[p]["title_str"] }).show() }
				if (!Grailbird.data[h]) {Grailbird.loadScript(m, j)}else{j()}
			},
		}
	})(a);

	(function (g) {
		var h=function (){this.str_singular="Tweet";this.str_plural="Tweets";this.status_index=tweet_index};
		h.prototype=Grailbird.extend({},a.base); g.tweets=function (){return new h()}
	})(Grailbird);

	(function (g){ g.localizeStrings=function (){ $("html").attr("lang","lolc"); document.title="Timeline"; }})(Grailbird);

	b.insertCommas = function d(g){g=g.toString(); return (g.length>3)?self.Grailbird.insertCommas(g.substr(0,g.length-3))+","+g.substr(g.length-3):g};
	b.createNavTab = function (i,h) {
		var g = "nav-" + i.toLowerCase(); $("#primary-nav").append(c.nav_tab.render({ sectionClass: g, sectionName: i })); $sectionTab = $("." + g);
		$sectionTab.click(function (j){ $(this).addClass("active").siblings().removeClass("active"); $(".row .contents, .sidebar").removeClass("container-messages"); f.setState(h); h.init() });
		return $sectionTab
	};
	b.loadScript = function (i, k) {
		var j = i.file_name, h = document.createElement("script"), g = function (){ i.loaded=true; k && k() }; h.src = j; h.charset = "utf-8";
		h.onreadystatechange=function (){if(this.readyState =="complete"||this.readyState=="loaded"){g()}}; h.onload=g; document.getElementsByTagName("head")[0].appendChild(h)
	}
})(Grailbird);
(function($){
$.fn.touchwipe = function(settings) {
	var config = { min_move_x: 200, preventDefaultEvents: false };
	if (settings) $.extend(config, settings);
 
	this.each(function() {
		var startX; var isMoving = false;

    		 function cancelTouch() {
			this.removeEventListener('touchmove',onTouchMove);
			startX=null; isMoving=false;
    		 }
    
		 function onTouchMove(e) {
			if(isMoving) {
				var x = e.touches[0].pageX; var dx = startX - x;
				if(Math.abs(dx) >= config.min_move_x) {
					cancelTouch();
					if(dx>0){config.wipeLeft();}else{config.wipeRight();}
				}
			}
		}

		function onTouchStart(e)
		{
			if (e.touches.length == 1) {
				 startX = e.touches[0].pageX; isMoving = true;
				 this.addEventListener('touchmove', onTouchMove, false);
			}
		}
		this.addEventListener('touchstart', onTouchStart, false);
     });
return this; }; })(jQuery);
$(document).ready(function (){Grailbird.init()});
